# Library Health Check Report — 2026-02-21

Branch: `feature/circuitbuilder-rethink`

## Metrics

| Metric | Baseline | Current | Status |
|--------|----------|---------|--------|
| Tests collected | 953 | 953 | ✓ Same |
| Tests passing | 940 | 940 | ✓ Same |
| Tests failing | 13 | 13 | ✓ Same |
| Coverage | 90% | 90% | ✓ Same |
| ty diagnostics | 91 | 91 | ✓ Same |
| ruff errors | 33 | 33 | ✓ Same |

No regressions detected.

## Structural Audit

### API Signature Consistency
**FINDING:** The `std_circuits/` module referenced in CLAUDE.md does not exist in the current codebase. It was removed/refactored as part of the `feature/circuitbuilder-rethink` branch. The `CircuitBuilder` class in `builder.py` is the current primary API.

**Action needed:** Update CLAUDE.md to reflect the current API structure. Remove references to `std_circuits/` factories or clarify they were replaced by `CircuitBuilder`.

### Symbol Port Validation
**2 inconsistencies found:**

| File | Line | Function | Issue |
|------|------|----------|-------|
| `src/pyschemaelectrical/symbols/blocks.py` | 20 | `terminal_box_symbol()` | `pins: tuple[str, ...] \| None = None` — should be `= ()` |
| `src/pyschemaelectrical/symbols/blocks.py` | 115 | `psu_symbol()` | `pins: tuple[str, ...] \| None = None` — should be `= ()` |

### Public API Completeness
**CLEAN** — All 102 exports in `__init__.py` reference existing code. No stale exports found.

### Tech Debt Scan
**CLEAN** — No TODO, FIXME, HACK, XXX, or WORKAROUND comments found in `src/`.

## Rendering Validation

### Snapshot Tests
All snapshot tests pass (included in the 940 passing tests).

### Example Scripts
**CRITICAL: Most example scripts are broken on this branch.**

| Example | Status | Error |
|---------|--------|-------|
| `example_dol_starter.py` | BROKEN | `ImportError: cannot import name 'std_circuits'` |
| `example_psu.py` | BROKEN | `ImportError: cannot import name 'std_circuits'` |
| `example_changeover.py` | BROKEN | `ImportError: cannot import name 'std_circuits'` |
| `example_emergency_stop.py` | BROKEN | `ImportError: cannot import name 'std_circuits'` |
| `example_wire_labels.py` | BROKEN | `ImportError: cannot import name 'std_circuits'` |
| `example_pin_configurations.py` | BROKEN | `ModuleNotFoundError: No module named 'pyschemaelectrical.std_circuits'` |
| `example_motor_symbol.py` | BROKEN | `TypeError: cannot unpack non-iterable ComponentRef object` |
| `example_dynamic_block.py` | BROKEN | `ImportError: attempted relative import with no known parent package` |
| `example_descriptors.py` | OK | Runs successfully, outputs SVG |

**Root cause:** The `std_circuits` module was removed as part of the CircuitBuilder rethink, but examples were not updated to use the new API.

## Auto-Fix

No auto-fixes applied this run. The issues found require manual intervention:
- Example scripts need rewriting to use `CircuitBuilder` instead of `std_circuits`
- Symbol pin defaults need human review before changing

## Recommendations

1. **HIGH** — Update or remove broken example scripts. They reference a deleted API (`std_circuits`).
2. **HIGH** — Update CLAUDE.md to remove/clarify `std_circuits` references.
3. **MEDIUM** — Fix `terminal_box_symbol()` and `psu_symbol()` pin defaults (`None` → `()`).
4. **MEDIUM** — Fix `example_motor_symbol.py` — `ComponentRef` unpacking issue suggests API change not reflected in example.
5. **LOW** — Investigate the 13 failing tests in `test_typst_compiler.py`.
